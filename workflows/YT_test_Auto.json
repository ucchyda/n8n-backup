{"createdAt":"2025-06-26T03:56:53.428Z","updatedAt":"2025-06-26T08:24:03.000Z","id":"zvkcrMzl3igIYui6","name":"YT_test_Auto","active":false,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"filters":{"q":"to:(rstreet.co.jp) subject:TEST"}},"type":"n8n-nodes-base.gmailTrigger","typeVersion":1.2,"position":[60,0],"id":"02ddd98a-cb38-4cb5-b202-e31545c35e55","name":"Gmail Trigger","credentials":{"gmailOAuth2":{"id":"eawXuiOGkVGOyVTm","name":"R STREET"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"GPT-4.1-MINI"},"messages":{"values":[{"content":"=# 指示\n## メール本文の内容を確認し、内容が会議の日程調整に関わるものであれば、「Yes」と出力してください。そうでなければ「No」と出力ください。メール本文が会議調整に関わるものかどうかは## 会議調整メールの例を確認ください。\n「Yes」、「No」以外は出力しないでください。\n\n## 会議調整メールの例\n株式会社XXX社\nYYY様\n平素より大変お世話になっております。\n早速のご調整をいただきありがとうございます。\n5月12日(月)13:00 - 14:00 にて、何卒よろしくお願いいたします。\n追ってWeb会議のURLをお送りさせていただきます。\n引き続き、どうぞよろしくお願いいたします。\nZZZ\n\n## メール本文\n{{ $json.snippet }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[220,0],"id":"ff2b913f-b183-4316-9011-c509c4157c0f","name":"Message a model","credentials":{"openAiApi":{"id":"kR54dvRsml2LlPBc","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"918a8393-f280-4b20-8c03-0ee00be3f3aa","leftValue":"={{ $json.message.content }}","rightValue":"Yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,0],"id":"daa48e2b-9d5b-42f8-a51a-34fa1401b1ee","name":"If"},{"parameters":{"promptType":"define","text":"=# 役割\n- あなたは株式会社アールストリートの田中としてメールを執筆します。\n\n# 指示\n1. 受信メールを確認し、候補日時が記載されているかチェックする\n2. 候補日時が記載されている場合：\n   - 提案された候補日時と `チームメンバー` の2週間分の予定の空き時間を突き合わせ、最も早い一致時間帯を1つ確定させる\n   - ただし打ち合わせ時間は1時間とする。`チームメンバー`の空き時間を1時間確保できない時間枠には打ち合わせは設定できない\n   - もし一致する時間帯が無い場合は、`チームメンバー`が空いている別候補を最大３件（早い順）提示する\n3. 候補日時が記載されていない場合：\n   - `チームメンバー` の今後2週間分の予定を確認し、`チームメンバー`が空いている時間帯から最小３件（早い順）の候補日程を提示する\n4. 上記を踏まえた返信メール本文を生成する\n\n## 受信メール\n{{ $('Gmail Trigger').item.json.snippet }}\n\n## チームメンバー\n- 田中太郎\n- 梶原俊一\n\n# 出力例\n（相手会社名）\n（相手氏名） 様\n\n平素より大変お世話になっております。\n株式会社アールストリートの田中でございます。\n\n（本文：確定日時の連絡または候補日程の提示）\n\n何卒よろしくお願い申し上げます。\n\nアールストリート\n田中\n\n# 備考\n- ツールを使うことで `チームメンバー` の今後2週間分の予定が確認できます。\n- `チームメンバー`の空き時間を1時間確保できない時間枠には打ち合わせは設定できないことを再度確認","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[800,-100],"id":"5aa4f33f-2efb-4343-943f-054469acc986","name":"AI Agent"},{"parameters":{"description":"このツールを呼び出して、田中の今後2週間の予定を取得してください。","workflowId":{"__rl":true,"value":"zzZGhWpHtpTfvaAX","mode":"list","cachedResultName":"YT_test_schedule_Tanaka"},"workflowInputs":{"mappingMode":"defineBelow","value":{"input":"Input"},"matchingColumns":["input"],"schema":[{"id":"input","displayName":"input","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[880,160],"id":"8e660ee9-302a-45a1-8a88-23ef88d02678","name":"YT_test_Tanaka"},{"parameters":{"jsCode":"// ----- 入力 -----\nconst replyPlain = $input.first().json.output;                    // AI が作った本文(プレーン)\nconst originalHtml = $('Gmail Trigger').first().json.html            // 元メール HTML\n                    || $('Gmail Trigger').first().json.snippet;          // HTML が無ければテキスト\n\n// ----- HTML 形式に整形 -----\nconst replyHtml = replyPlain\n  .replace(/\\n/g, '<br>');                         // 改行を <br> に\n\n// Gmail が自動で折り畳んでくれる \"gmail_quote\" ブロック\nconst quotedHtml = `\n<br><br>\n<div class=\"gmail_quote\">\n  <blockquote class=\"gmail_quote\"\n    style=\"margin:0 0 0 .8ex;border-left:1px solid #ccc;padding-left:1ex\">\n    ${originalHtml}\n  </blockquote>\n</div>`;\n\n// ----- 出力 -----\n// itemオブジェクトを新規作成\nconst item = {\n  message: replyHtml + quotedHtml             // Gmail ノードの message に渡す\n};\n\nreturn item;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1160,-100],"id":"9777dc28-44a7-4f7d-9456-b865fc6204a3","name":"Code"},{"parameters":{"resource":"draft","subject":"=RE:  {{ $('Gmail Trigger').item.json.Subject }}","emailType":"html","message":"={{ $json.message }}","options":{"replyTo":"={{ $('Gmail Trigger').item.json.From }}","threadId":"={{ $('Gmail Trigger').item.json.threadId }}"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1340,-100],"id":"c191ae45-993e-407b-baf3-c5b652006b9d","name":"Create a draft","webhookId":"d2d6c1de-a4c5-4fc1-8da2-dcc07bbe1b57","credentials":{"gmailOAuth2":{"id":"eawXuiOGkVGOyVTm","name":"R STREET"}}},{"parameters":{"description":"このツールを呼び出して、梶原の今後2週間の予定を取得してください。","workflowId":{"__rl":true,"value":"A7fM5EG5jHs1xn1J","mode":"list","cachedResultName":"YT_test_schedule_Kajiwara"},"workflowInputs":{"mappingMode":"defineBelow","value":{"input":"Input"},"matchingColumns":["input"],"schema":[{"id":"input","displayName":"input","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1040,160],"id":"b02940d0-c689-4035-9b70-40380a75471b","name":"YT_test_Kajiwara"},{"parameters":{"model":{"__rl":true,"value":"o4-mini","mode":"list","cachedResultName":"o4-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[720,160],"id":"d5a459c4-bda7-4ba3-a8f4-046029b6a035","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"kR54dvRsml2LlPBc","name":"OpenAi account"}}}],"connections":{"Gmail Trigger":{"main":[[{"node":"Message a model","type":"main","index":0}]]},"Message a model":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"YT_test_Tanaka":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"AI Agent":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Create a draft","type":"main","index":0}]]},"YT_test_Kajiwara":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"308cc1b6-5f7f-4ad6-8733-f82f9e0e67be","triggerCount":0,"tags":[]}