{"createdAt":"2025-07-14T06:35:06.798Z","updatedAt":"2025-07-14T08:07:40.000Z","id":"GQM6y6xXzfJkHf40","name":"Reply Agent_v02","active":false,"isArchived":true,"nodes":[{"parameters":{"promptType":"define","text":"={{ $json.chatInput }}","options":{"systemMessage":"=# 役割\nあなたは、株式会社アールストリートに所属する内田として、受信したメールへの返信を自律的に代行するAIエージェントです。単にタスクを処理するだけでなく、受信メールの文脈やニュアンスを深く理解し、人間らしい自然なコミュニケーションを行うことを最優先とします。\n\n# 指示\n**必ず** ツールを利用してメール文章のドラフトを作成してください。\n\n## ツール\n- **Codeツール**: HTML形式のメール文章を作成するために利用します。\n- **Create a draft in Gmail**: メールの下書きを作成するために利用します。"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[720,420],"id":"5ab31bb9-871f-41b1-aa90-4a349b98c50f","name":"返信下書き Agent","onError":"continueErrorOutput"},{"parameters":{"resource":"draft","subject":"={{ $fromAI('Subject', ``, 'string') }}","emailType":"html","message":"={{ $fromAI('Message', ``, 'string') }}","options":{"ccList":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('CC', ``, 'string') }}","replyTo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Send_Replies_To', ``, 'string') }}","threadId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Thread_ID', ``, 'string') }}","sendTo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To_Email', ``, 'string') }}"}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[1000,640],"id":"d9b3553f-05c0-460c-b8ea-fb446acd35c7","name":"Create a draft in Gmail","webhookId":"6de304ef-a7bc-4d0f-a00a-09f040a3aefd","credentials":{"gmailOAuth2":{"id":"eawXuiOGkVGOyVTm","name":"R STREET"}}},{"parameters":{"description":"このツールは、Gmailの返信メールをHTML形式にするために利用されるツールです。","jsCode":"// ----- 入力 -----\nconst replyPlain = {{ $fromAI('query', ``, 'string') }};    // AI が作った本文(プレーン)\nconst originalHtml = $('Gmail Trigger').first().json.html           // 元メール HTML\n                    || $('Gmail Trigger').first().json.text;          // HTML が無ければテキスト\n\n// ----- HTML 形式に整形 -----\nconst replyHtml = replyPlain\n  .replace(/\\n/g, '<br>');                         // 改行を <br> に\n\n// Gmail が自動で折り畳んでくれる \"gmail_quote\" ブロック\nconst quotedHtml = `\n<br><br>\n<div class=\"gmail_quote\">\n  <blockquote class=\"gmail_quote\"\n    style=\"margin:0 0 0 .8ex;border-left:1px solid #ccc;padding-left:1ex\">\n    ${originalHtml}\n  </blockquote>\n</div>`;\n\n// ----- 出力 -----\n// itemオブジェクトを新規作成\nconst item = {\n  message: replyHtml + quotedHtml             // Gmail ノードの message に渡す\n};\n\nreturn item;"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[860,640],"id":"a8543db6-9c75-4b98-ad33-a3968edf9c5a","name":"Code Tool"},{"parameters":{"modelName":"models/gemini-2.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[700,640],"id":"7f029d53-7413-4f07-9e68-0c9ea863a1f4","name":"Google Gemini Chat Model2","credentials":{"googlePalmApi":{"id":"HLetr3K9FMGJtocg","name":"Google Gemini(PaLM) Api account 4"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[520,420],"id":"05dd8d1d-ccd2-4a3e-aae3-b9dd2a6c0b6f","name":"When chat message received","webhookId":"8639b096-38d7-4646-8305-ecc34182f708"}],"connections":{"Create a draft in Gmail":{"ai_tool":[[{"node":"返信下書き Agent","type":"ai_tool","index":0}]]},"Code Tool":{"ai_tool":[[{"node":"返信下書き Agent","type":"ai_tool","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[{"node":"返信下書き Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"返信下書き Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"5a450a57-2dfd-4d13-833e-b1f1f4cdb3a3","triggerCount":0,"tags":[{"createdAt":"2025-07-03T07:23:34.599Z","updatedAt":"2025-07-03T09:57:04.256Z","id":"Zey1DTgFzw4vuivz","name":"Secretary Agent"},{"createdAt":"2025-06-18T07:58:49.669Z","updatedAt":"2025-07-03T09:01:04.709Z","id":"w3Cnd8StpKPr7ekR","name":"on test"}]}